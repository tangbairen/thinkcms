<extend name="Public:base"/>
<block name="title">修改管理员</block>
<block name="css"><icheckcss/>
</block>
<block name="content">
    <style>
        .input-medium{width: 300px;}
    </style>
    <div class="page-header">
        <h1><i class="fa fa-home"></i> 首页 &gt; 客户资源 &gt; 修改数据</h1>
    </div><div class="col-xs-12">
    <div class="tabbable">
        <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab">
            <li> <a href="{:U('Admin/Resource/customer')}">数据列表</a></li>
            <li class="active"> <a>修改数据</a></li>
        </ul>
        <div class="tab-content">
            <form class="form-inline" method="post" action="{:U('Admin/Resource/modify')}">
                <input type="hidden" name="id" value="{$user_data['id']}">
                <table class="table table-striped table-bordered table-hover table-condensed">
                    <tr>
                        <th>客户信息修改</th>
                        <td></td>
                    </tr>
                    <tr>
                        <th>ID</th>
                        <td>
                            <input class="input-medium" type="text" name="id" value="{$data['id']}" readonly>
                        </td>
                    </tr>

                    <tr>
                        <th>客服姓名</th>
                        <td> <input class="input-medium" type="text" name="username" value="{$data['username']}"></td>
                    </tr>
                    <tr>
                        <th>手机号</th>
                        <td> <input class="input-medium" type="text" name="phone" value="{$data['phone']}"></td>
                    </tr>
                    <tr>
                        <th>QQ/微信</th>
                        <td> <input class="input-medium" type="text" value="{$data['chats']}" name="chats"></td>
                    </tr>
                    <tr>
                        <th>客服ID/名字</th>
                        <td> <input class="input-medium" type="text" value="{$data['customer_info']}" name="customer_info"></td>
                    </tr>
                    <tr>
                        <th>省份</th>
                        <td>
                            <select name="province" id="province">
                                <option value="">请选择省份</option>
                                <foreach name="province" item="val">
                                    <option value="{$val['id']}" <if condition="$val['id'] eq $data['province']">selected</if> >{$val['name']}</option>
                                </foreach>
                            </select>
                            <span>(必填)</span>
                        </td>
                    </tr>
                    <tr>
                        <th>地址</th>
                        <td> <input class="input-medium" type="text" value="{$data['address']}" name="address"></td>
                    </tr>
                    <tr>
                        <th>来源渠道</th>
                        <td> <input class="input-medium" type="text" value="{$data['source']}" name="source"></td>
                    </tr>
                   <!-- <tr>
                        <th>品牌</th>
                        <td>
                            <input class="input-medium" type="text" value="{$brand_name}" readonly name="brand_name">
                            <a href="" data-toggle="modal" data-target="#exampleModal2" data-whatever="@fat">点击修改</a>
                        </td>
                        <input type="hidden" name="brand_id" value="{$data['brand_id']}">
                    </tr>-->
                    <tr>
                        <th>品牌</th>
                        <td>
                            <input class="input-medium" type="text" value="{$brand_name}" readonly name="brand_name">
                            <a href="" data-toggle="modal" data-target="#exampleModal2" data-whatever="@fat">点击修改</a>
                            <span>(必填)</span>
                        </td>
                        <input type="hidden" name="brand_id" value="{$data['brand_id']}">
                    </tr>
                    <tr>
                        <th>用户组（所属）</th>
                        <td>
                            <input class="input-medium" type="text" name="group" value="{$group_name}" readonly>
                            <input type="hidden" name="group_id" value="{$data['group_id']}">
                            <a href="" data-toggle="modal" onclick="return group();" data-target="#exampleModal" data-whatever="@fat">点击修改</a>
                        </td>
                    </tr>
                    <tr>
                        <th>关键字</th>
                        <td> <input class="input-medium" type="text" value="{$data['keyword']}" name="keyword"></td>
                    </tr>

                    <tr>
                        <th></th>
                        <td>
                            <input class="btn btn-success" type="submit" onclick="return edit();" value="修改">
                            <input class="btn btn-danger" type="submit" onclick="check();" value="取消">
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
    <!--用户组-->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="exampleModalLabel">修改所属组</h4>
                </div>
                <div class="modal-body">
                        <!--<foreach name="autGroup" item="val">
                            <span style="padding-right: 15px;padding-left: 5px;">{$val['title']}
                                <input class="xb-icheck" type="radio" name="group_user"
                                       groupName="{$val['title']}" value="{$val['id']}"
                                <if condition="$val['id'] eq $data['group_id']"> checked </if> >
                            </span>
                        </foreach>-->
                    <form id="groupform">

                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="group_confirm();">确定</button>
                </div>
            </div>
        </div>
    </div>
    <!--end 用户组-->

    <div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="exampleModalLabel">修改咨询品牌</h4>
                </div>
                <div class="modal-body">
                    <form>
                        <foreach name="brandArr" item="val">
                            <span style="padding-right: 15px;padding-left: 5px;">{$val['name']}
                                <input class="xb-icheck" type="radio" name="brand_title"
                                       brandName="{$val['name']}" value="{$val['id']}"
                                <if condition="$val['id'] eq $data['brand_id']"> checked </if> >
                            </span>
                        </foreach>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="brand_confirm();">确定</button>
                </div>
            </div>
        </div>
    </div>


</div>
</block>
<block name="js">
    <icheckjs color="blue"/>
    <script>

        function check(){

            window.history.go(-1);
        }

        function group_confirm(){
            var groupid=$("input[name='group_user']:checked").val();
            var groupName=$("input[name='group_user']:checked").attr('groupName');
            if(typeof(groupid) == 'undefined'){
                alert('请选择所属组');
                return false;
            }

            $("input[name='group_id']").val(groupid);
            $("input[name='group']").val(groupName);
            $('#exampleModal').modal('hide');
        }

        function brand_confirm(){
            var brand_id=$("input[name='brand_title']:checked").val();
            var brandName=$("input[name='brand_title']:checked").attr('brandName');
            if(typeof(brand_id) == 'undefined'){
                alert('请选择咨询品牌');
                return false;
            }

            $("input[name='brand_id']").val(brand_id);
            $("input[name='brand_name']").val(brandName);
            $('#exampleModal2').modal('hide');
        }

        function group(){
            var province=$('#province').val();
            var brand_name=$("input[name='brand_name']").val();
            var brand_id=$("input[name='brand_id']").val();
            var group_id=$("input[name='group_id']").val();
            console.log(group_id);
            if(province == ''){
                alert('请先选择省份');
                return false;
            }

            if(brand_name == ''){
                alert('请先选择品牌');
                return false;
            }

            $.ajax({
                'url':"{:U('Admin/Resource/group')}",
                'type':'get',
                'data':{'province':province,'brand_id':brand_id},
                'dataType':'json',
                'success':function(data){
                    $('#groupform').html('');
                    $str='';
                    var select='';
                    $.each(data,function(i,val){
                        console.log(val['id']);
                        if(group_id == val['id']){
                            select ='checked';
                        }
                        $str +="<span style='padding-right: 15px;padding-left: 5px;'>"+val['title']+"<input class='xb-icheck' type='radio' name='group_user' "+select+" groupName='"+val['title']+"' value='"+val['id']+"'> </span>";
                    });

                    $('#groupform').append($str);

                }



            });

        }

    </script>



</block>